<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Trading Dashboard (fixed)</title>
  <style>
    body {font-family: system-ui; margin: 0; padding: 2rem; background: #111; color:#eee}
    h1   {margin-top: 0; font-size: 1.8rem}
    .btn {padding: .5rem 1rem; border: 1px solid #fff; background: none; color:#fff; cursor: pointer}
    .flex{display:flex; gap:2rem; flex-wrap: wrap}
    .card{background:#222; padding:1rem; border-radius:4px; min-width:260px}
    pre {white-space: pre-wrap; word-break: break-word}
  </style>
</head>
<body>
  <h1>Trading Dashboard</h1>
  <button id="connect" class="btn">Connect Binance API</button>

  <div class="flex">
    <div class="card">
      <h2>Balance</h2>
      <pre id="balance">—</pre>
    </div>
    <div class="card">
      <h2>Positions</h2>
      <pre id="positions">—</pre>
    </div>
    <div class="card">
      <h2>Earn</h2>
      <pre id="earn">—</pre>
    </div>
  </div>

  <script>
    let clientId = null;
    const getJSON = path => fetch(path).then(r => r.json());

    async function refresh() {
      if (!clientId) return;
      document.getElementById('balance').textContent   =
          JSON.stringify(await getJSON(`/api/balance/${clientId}`  ), null, 2);
      document.getElementById('positions').textContent =
          JSON.stringify(await getJSON(`/api/positions/${clientId}`), null, 2);
      document.getElementById('earn').textContent      =
          JSON.stringify(await getJSON(`/api/earn/${clientId}`     ), null, 2);
    }
    setInterval(refresh, 20000);

    document.getElementById('connect').onclick = async () => {
      const res = await fetch('/api/connect', {method: 'POST'}).then(r => r.json());
      if (res.success) {
        clientId = res.client_id;
        alert('Connected as ' + clientId);
        refresh();
      } else {
        alert(res.error);
      }
    };
  </script>
</body>
</html>
